<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &mdash; PyMuPDF 1.8.0 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PyMuPDF 1.8.0 documentation" href="index.html" />
    <link rel="next" title="Classes and Methods" href="class_index.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="class_index.html" title="Classes and Methods"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyMuPDF 1.8.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#import-the-bindings">Import the Bindings</a></li>
<li><a class="reference internal" href="#open-a-document">Open a Document</a></li>
<li><a class="reference internal" href="#some-document-methods-and-attributes">Some <code class="docutils literal"><span class="pre">Document</span></code> methods and attributes</a></li>
<li><a class="reference internal" href="#access-meta-data">Access Meta Data</a></li>
<li><a class="reference internal" href="#work-with-outlines">Work with Outlines</a></li>
<li><a class="reference internal" href="#work-with-pages">Work with Pages</a><ul>
<li><a class="reference internal" href="#inspect-the-links-on-a-page">Inspect the links on a <code class="docutils literal"><span class="pre">Page</span></code></a></li>
<li><a class="reference internal" href="#render-a-page">Render a <code class="docutils literal"><span class="pre">Page</span></code></a></li>
<li><a class="reference internal" href="#save-the-page-image-in-a-file">Save the page image in a file</a></li>
<li><a class="reference internal" href="#display-the-image-in-dialog-managers">Display the image in dialog managers</a></li>
<li><a class="reference internal" href="#text-extraction">Text extraction</a></li>
<li><a class="reference internal" href="#text-searching">Text Searching</a></li>
</ul>
</li>
<li><a class="reference internal" href="#output">Output</a></li>
<li><a class="reference internal" href="#close">Close</a></li>
<li><a class="reference internal" href="#example-dynamically-cleaning-up-corrupt-pdf-documents">Example: Dynamically cleaning up corrupt PDF documents</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="class_index.html"
                        title="next chapter">Classes and Methods</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will show you the use of MuPDF in Python step by step.</p>
<p>Because MuPDF supports not only PDF, but also XPS, OpenXPS and EPUB formats, so does PyMuPDF. Nevertheless we will only talk about PDF files for the sake of brevity.</p>
<p>As for string handling, MuPDF will pass back any string as UTF-8 encoded - no exceptions. Where this binding has added functionality, we usually decode string to unicode. An example is the <code class="xref py py-meth docutils literal"><span class="pre">Document.ToC()</span></code> method.</p>
<div class="section" id="import-the-bindings">
<h2>Import the Bindings<a class="headerlink" href="#import-the-bindings" title="Permalink to this headline">¶</a></h2>
<p>The Python bindings to MuPDF are made available by this import statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">fitz</span>
</pre></div>
</div>
</div>
<div class="section" id="open-a-document">
<h2>Open a Document<a class="headerlink" href="#open-a-document" title="Permalink to this headline">¶</a></h2>
<p>In order to access a supported document, it must be opened with the following statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Document</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>This will create <code class="docutils literal"><span class="pre">doc</span></code> as a <a class="reference internal" href="document.html#document"><span>Document</span></a> object. <code class="docutils literal"><span class="pre">filename</span></code> must be a Python string or unicode object that specifies the name of an existing file (with or without a fully or partially qualified path).</p>
<p>It is also possible to construct a document from memory data, i.e. without using a file. See <a class="reference internal" href="document.html#document"><span>Document</span></a> for details.</p>
<p>A <a class="reference internal" href="document.html#document"><span>Document</span></a> contains several attributes and functions. Among them are meta information (like &#8220;author&#8221; or &#8220;subject&#8221;), number of total pages, outline and encryption information.</p>
</div>
<div class="section" id="some-document-methods-and-attributes">
<h2>Some <a class="reference internal" href="document.html#document"><span>Document</span></a> methods and attributes<a class="headerlink" href="#some-document-methods-and-attributes" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Method / Attribute</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="document.html#Document.pageCount" title="Document.pageCount"><code class="xref py py-attr docutils literal"><span class="pre">Document.pageCount</span></code></a></td>
<td>Number of pages of <code class="docutils literal"><span class="pre">filename</span></code> (integer).</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="document.html#Document.metadata" title="Document.metadata"><code class="xref py py-attr docutils literal"><span class="pre">Document.metadata</span></code></a></td>
<td>Metadata of the <code class="docutils literal"><span class="pre">Document</span></code> (dictionary).</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="document.html#Document.outline" title="Document.outline"><code class="xref py py-attr docutils literal"><span class="pre">Document.outline</span></code></a></td>
<td>First outline entry of <code class="docutils literal"><span class="pre">Document</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="document.html#Document.getToC" title="Document.getToC"><code class="xref py py-meth docutils literal"><span class="pre">Document.getToC()</span></code></a></td>
<td>Table of contents of <code class="docutils literal"><span class="pre">Document</span></code> (list).</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="document.html#Document.loadPage" title="Document.loadPage"><code class="xref py py-meth docutils literal"><span class="pre">Document.loadPage()</span></code></a></td>
<td>Create a <code class="docutils literal"><span class="pre">Page</span></code> object.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="access-meta-data">
<h2>Access Meta Data<a class="headerlink" href="#access-meta-data" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="document.html#Document.metadata" title="Document.metadata"><code class="xref py py-attr docutils literal"><span class="pre">Document.metadata</span></code></a> is a Python dictionary with the following keys. For details of their meanings and formats consult the PDF manuals, e.g. <a class="reference external" href="http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/pdf_reference_1-7.pdf">Adobe PDF Reference sixth edition 1.7 November 2006</a>. Further information can also be found in chapter <a class="reference internal" href="document.html#document"><span>Document</span></a>. The meta data fields are of type string if not otherwise indicated and may be missing, in which case they contain <code class="docutils literal"><span class="pre">None</span></code>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Key</strong></th>
<th class="head"><strong>Value</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><dl class="first last data">
<dt id="producer">
<code class="descname">producer</code><a class="headerlink" href="#producer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</td>
<td>Producer (producing software)</td>
</tr>
<tr class="row-odd"><td><dl class="first last data">
<dt id="format">
<code class="descname">format</code><a class="headerlink" href="#format" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</td>
<td>PDF format, e.g. &#8216;PDF-1.4&#8217;</td>
</tr>
<tr class="row-even"><td><dl class="first last data">
<dt id="encryption">
<code class="descname">encryption</code><a class="headerlink" href="#encryption" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</td>
<td>Encryption method used</td>
</tr>
<tr class="row-odd"><td><dl class="first last data">
<dt id="author">
<code class="descname">author</code><a class="headerlink" href="#author" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</td>
<td>Author</td>
</tr>
<tr class="row-even"><td><dl class="first last data">
<dt id="modDate">
<code class="descname">modDate</code><a class="headerlink" href="#modDate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</td>
<td>Date of last modification</td>
</tr>
<tr class="row-odd"><td><dl class="first last data">
<dt id="keywords">
<code class="descname">keywords</code><a class="headerlink" href="#keywords" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</td>
<td>Keywords</td>
</tr>
<tr class="row-even"><td><dl class="first last data">
<dt id="title">
<code class="descname">title</code><a class="headerlink" href="#title" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</td>
<td>Title</td>
</tr>
<tr class="row-odd"><td><dl class="first last data">
<dt id="creationDate">
<code class="descname">creationDate</code><a class="headerlink" href="#creationDate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</td>
<td>Date of creation</td>
</tr>
<tr class="row-even"><td><dl class="first last data">
<dt id="creator">
<code class="descname">creator</code><a class="headerlink" href="#creator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</td>
<td>Creating application</td>
</tr>
<tr class="row-odd"><td><dl class="first last data">
<dt id="subject">
<code class="descname">subject</code><a class="headerlink" href="#subject" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</td>
<td>Subject</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="work-with-outlines">
<h2>Work with Outlines<a class="headerlink" href="#work-with-outlines" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to get all outlines of a document, is creating a table of contents:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">toc</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">getToC</span><span class="p">(</span><span class="n">simple</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>       <span class="c"># the simple form, if False, link information is included</span>
</pre></div>
</div>
<p>This will return a Python list <code class="docutils literal"><span class="pre">[[level,</span> <span class="pre">title,</span> <span class="pre">page,</span> <span class="pre">link],</span> <span class="pre">...]</span></code> (or <code class="docutils literal"><span class="pre">[]</span></code>).</p>
<p><code class="docutils literal"><span class="pre">level</span></code> is the hierarchy level of the entry (starting from 1), <code class="docutils literal"><span class="pre">title</span></code> is the entry&#8217;s title (unicode), and <code class="docutils literal"><span class="pre">page</span></code> the page number (1-based). <code class="docutils literal"><span class="pre">link</span></code> is present if <code class="docutils literal"><span class="pre">simple</span> <span class="pre">=</span> <span class="pre">False</span></code> is specified. Its meaning can be look up under <a class="reference internal" href="page.html#Page.getLinks" title="Page.getLinks"><code class="xref py py-meth docutils literal"><span class="pre">Page.getLinks()</span></code></a>.</p>
<p>If you want a more detailed control of what you get, enter the document&#8217;s outline tree like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">olItem</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">outline</span>    <span class="c"># the document&#39;s first outline item</span>
</pre></div>
</div>
<p>This creates olItem as an <a class="reference internal" href="outline.html#outline"><span>Outline</span></a> object. Look there for further details.</p>
</div>
<div class="section" id="work-with-pages">
<h2>Work with Pages<a class="headerlink" href="#work-with-pages" title="Permalink to this headline">¶</a></h2>
<p>Tasks that can be performed with a <a class="reference internal" href="page.html#page"><span>Page</span></a> are at the core of MuPDF&#8217;s functionality.
Among other things, you can render a <a class="reference internal" href="page.html#page"><span>Page</span></a>, optionally zooming, rotating or shearing it.
You can write it&#8217;s image to files (in PNG format), extract text from it or search for text strings.
At first, a page object must be created:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">loadPage</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>        <span class="c"># represents page n of the document</span>
</pre></div>
</div>
<p>Some typical uses of <a class="reference internal" href="page.html#page"><span>Page</span></a> objects follow:</p>
<div class="section" id="inspect-the-links-on-a-page">
<h3>Inspect the links on a <a class="reference internal" href="page.html#page"><span>Page</span></a><a class="headerlink" href="#inspect-the-links-on-a-page" title="Permalink to this headline">¶</a></h3>
<p>Here is how to get all links and their types:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#-----------------------------------------------------------------------------------</span>
<span class="c"># Get all links of the current page</span>
<span class="c">#-----------------------------------------------------------------------------------</span>
<span class="n">links</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">getLinks</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">links</span></code> is a Python list containing Python dictionaries as entries. For details see <a class="reference internal" href="page.html#Page.getLinks" title="Page.getLinks"><code class="xref py py-meth docutils literal"><span class="pre">Page.getLinks()</span></code></a>.</p>
</div>
<div class="section" id="render-a-page">
<h3>Render a <a class="reference internal" href="page.html#page"><span>Page</span></a><a class="headerlink" href="#render-a-page" title="Permalink to this headline">¶</a></h3>
<p>This example creates an image out of a page&#8217;s content:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pix</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">getPixmap</span><span class="p">(</span><span class="n">matrix</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Identity</span><span class="p">,</span> <span class="n">colorspace</span> <span class="o">=</span> <span class="s">&quot;RGB&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------------------------------------------------------------</span>
<span class="c"># now pix contains an RGB image of the page, ready to be used</span>
<span class="c">#-----------------------------------------------------------------------------------</span>
</pre></div>
</div>
</div>
<div class="section" id="save-the-page-image-in-a-file">
<h3>Save the page image in a file<a class="headerlink" href="#save-the-page-image-in-a-file" title="Permalink to this headline">¶</a></h3>
<p>We can simply store the image in a PNG file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pix</span><span class="o">.</span><span class="n">writePNG</span><span class="p">(</span><span class="s">&quot;test.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="display-the-image-in-dialog-managers">
<h3>Display the image in dialog managers<a class="headerlink" href="#display-the-image-in-dialog-managers" title="Permalink to this headline">¶</a></h3>
<p>We can also use the image in a dialog. <a class="reference internal" href="pixmap.html#Pixmap.samples" title="Pixmap.samples"><code class="xref py py-attr docutils literal"><span class="pre">Pixmap.samples</span></code></a> represents the area of bytes of all the pixels as a Python bytearray. This area (or its <code class="docutils literal"><span class="pre">str()</span></code>-version), is directly usable by presumably most dialog managers. Here are two examples. Please also have a look at the examples directory of this repository.</p>
<p><strong>wxPython</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="n">pix</span><span class="o">.</span><span class="n">samples</span>                          <span class="c"># data = bytearray of raw pixel data (RGBA)</span>
<span class="n">bitmap</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BitmapFromBufferRGBA</span><span class="p">(</span><span class="n">pix</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="c"># image width</span>
            <span class="n">pix</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>                     <span class="c"># image height</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>                      <span class="c"># wxPython only accepts strings, no bytearrays</span>
</pre></div>
</div>
<p><strong>Tkinter</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="n">pix</span><span class="o">.</span><span class="n">samples</span>
<span class="c"># the following requires: &quot;from PIL import Image&quot;</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="s">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">pix</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">pix</span><span class="o">.</span><span class="n">height</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="n">photo</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="text-extraction">
<h3>Text extraction<a class="headerlink" href="#text-extraction" title="Permalink to this headline">¶</a></h3>
<p>We can also extract all text of a page in one chunk of string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">text</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="n">output</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For the <code class="docutils literal"><span class="pre">output</span></code> parameter, the following values can be specified:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">text</span></code>: plain text with line breaks. No format and no position info.</li>
<li><code class="docutils literal"><span class="pre">html</span></code>: line breaks, alignment, grouping. No format and no position info</li>
<li><code class="docutils literal"><span class="pre">json</span></code>: full formatting info (except colors and fonts) down to spans (see appendix)</li>
<li><code class="docutils literal"><span class="pre">xml</span></code>: full formatting info (except colors) down to individual characters</li>
</ul>
<p>To give you an idea about the output of these alternatives, we did text extracts from this document&#8217;s PDF version and several other examples. See the appendix for details about implications on processing times and space requirements.</p>
</div>
<div class="section" id="text-searching">
<h3>Text Searching<a class="headerlink" href="#text-searching" title="Permalink to this headline">¶</a></h3>
<p>You can find out, exactly where on a page a certain string appears like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">areas</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">searchFor</span><span class="p">(</span><span class="s">&quot;mupdf&quot;</span><span class="p">,</span> <span class="n">hit_max</span> <span class="o">=</span> <span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
<p>The variable <code class="docutils literal"><span class="pre">areas</span></code> will now contain a list of up to 32 <a class="reference internal" href="rect.html#rect"><span>Rect</span></a> rectangles which surround each occurrence of string &#8220;mupdf&#8221; (not case sensitive).</p>
<p>Please also do have a look at the demonstration program <code class="docutils literal"><span class="pre">demo.py</span></code>. Among others it contains details on how the <a class="reference internal" href="textpage.html#textpage"><span>TextPage</span></a>, <a class="reference internal" href="textsheet.html#textsheet"><span>TextSheet</span></a>, <a class="reference internal" href="device.html#device"><span>Device</span></a> and <a class="reference internal" href="displaylist.html#displaylist"><span>DisplayList</span></a> classes can be used for a more direct control, e.g. when performance considerations require it.</p>
</div>
</div>
<div class="section" id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h2>
<p>Output capabilities of MuPDF (such as PDF generation) are currently very limited. However, a copy of a currently opened document can be created (PDF only, none of the other file types).</p>
<p>We support this with the method <a class="reference internal" href="document.html#Document.save" title="Document.save"><code class="xref py py-meth docutils literal"><span class="pre">Document.save()</span></code></a>.</p>
<p>If the document had been successfully decrypted before, <code class="docutils literal"><span class="pre">save()</span></code> will automatically create a decrypted copy.</p>
<p>In addition, this method will also perform some clean-up:</p>
<p>If the document containes invalid or broken xrefs, the saved version will have them automatically corrected, which makes it readable by other Python PDF software, like <a class="reference external" href="https://github.com/pmaupin/pdfrw">pdfrw</a> or <a class="reference external" href="http://mstamy2.github.io/PyPDF2">PyPDF2</a>. In many cases, the saved version will also be smaller than the original.</p>
<p><a class="reference internal" href="document.html#Document.save" title="Document.save"><code class="xref py py-meth docutils literal"><span class="pre">Document.save()</span></code></a> now also supports all options of MuPDF&#8217;s command line utility <code class="docutils literal"><span class="pre">mutool</span> <span class="pre">clean</span></code>, see below (mutool clean option = &#8220;MCO&#8221;).</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="9%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Option</strong></th>
<th class="head"><strong>MCO</strong></th>
<th class="head"><strong>Effect</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>garbage = 1</td>
<td>-g</td>
<td>garbage collect unused objects</td>
</tr>
<tr class="row-odd"><td>garbage = 2</td>
<td>-gg</td>
<td>in addition to 1, compact xref tables</td>
</tr>
<tr class="row-even"><td>garbage = 3</td>
<td>-ggg</td>
<td>in addition to 2, merge duplicate objects</td>
</tr>
<tr class="row-odd"><td>clean = 1</td>
<td>-s</td>
<td>clean content streams (avoid or use with care!)</td>
</tr>
<tr class="row-even"><td>deflate = 1</td>
<td>-z</td>
<td>deflate uncompressed streams</td>
</tr>
<tr class="row-odd"><td>ascii = 1</td>
<td>-a</td>
<td>convert data to ASCII format</td>
</tr>
<tr class="row-even"><td>linear = 1</td>
<td>-l</td>
<td>create a linearized version (do not use yet)</td>
</tr>
<tr class="row-odd"><td>expand = 1</td>
<td>-i</td>
<td>decompress images</td>
</tr>
<tr class="row-even"><td>expand = 2</td>
<td>-f</td>
<td>decompress fonts</td>
</tr>
<tr class="row-odd"><td>expand = 255</td>
<td>-d</td>
<td>decompress all</td>
</tr>
<tr class="row-even"><td>incremental = 1</td>
<td>n/a</td>
<td>only save data that have changed (do not use yet)</td>
</tr>
</tbody>
</table>
<p>Please note, that <a class="reference internal" href="document.html#Document.save" title="Document.save"><code class="xref py py-meth docutils literal"><span class="pre">Document.save()</span></code></a>, according to MuPDF&#8217;s documentation, is still being further developed, so expect changes in the future here. Also observe our remarks in the above table.</p>
<p>Like with <code class="docutils literal"><span class="pre">mutool</span> <span class="pre">clean</span></code>, not all combinations of the above options may work for all documents - so be ready to experiment a little.</p>
<p>We have found, that the fastest, yet very stable combination is <code class="docutils literal"><span class="pre">mutool</span> <span class="pre">clean</span> <span class="pre">-ggg</span> <span class="pre">-z</span></code>, giving good compression results. In PyMuPDF this corresponds to <code class="docutils literal"><span class="pre">doc.save(filename,</span> <span class="pre">garbage=3,</span> <span class="pre">deflate=1)</span></code>.</p>
<p>In some cases, best compression factors result, if <code class="docutils literal"><span class="pre">expand</span></code> and <code class="docutils literal"><span class="pre">deflate</span></code> are used together, though they seem to be contradictory. This works, because MuPDF is forced to expand and then re-compress all objects, which will correct poor compressions during document creation.</p>
</div>
<div class="section" id="close">
<h2>Close<a class="headerlink" href="#close" title="Permalink to this headline">¶</a></h2>
<p>In some situations it is desirable to &#8220;close&#8221; a <a class="reference internal" href="document.html#document"><span>Document</span></a> such that it becomes fully available again to the OS while your program is still running.</p>
<p>This can be achieved by the <a class="reference internal" href="document.html#Document.close" title="Document.close"><code class="xref py py-meth docutils literal"><span class="pre">Document.close()</span></code></a> method. Apart from closing the file, all buffer areas associated with the document will be freed. If the document has been created from memory data, no underlying file is opened by MuPDF, so only the buffer release will take place.</p>
<p><strong>Caution:</strong></p>
<p>As with normal file objects, after close, the document and all objects referencing it will be invalid  and <strong>must no longer be used</strong>. This binding protects against most such invalid uses by disabling properties and methods of the <a class="reference internal" href="document.html#document"><span>Document</span></a> and any associated <a class="reference internal" href="document.html#Document.loadPage" title="Document.loadPage"><code class="xref py py-meth docutils literal"><span class="pre">Document.loadPage()</span></code></a> objects.</p>
<p>However, re-opening a previously closed file by a new <a class="reference internal" href="document.html#document"><span>Document</span></a> is no problem. Please also do have a look at the following valid example:</p>
<div class="highlight-python"><div class="highlight"><pre>doc = fitz.Document(f_old)           # open a document
&lt;... some statements ...&gt;            # e.g. decryption
doc.save(fnew, garbage=3, deflate=1) # save a decrypted / compressed version
doc.close()                          # close input file
os.remove(f_old)                     # remove it
os.rename(f_new, f_old)              # rename the decrypted / cleaned version
doc = fitz.Document(f_old)           # use it as input for MuPDF
</pre></div>
</div>
</div>
<div class="section" id="example-dynamically-cleaning-up-corrupt-pdf-documents">
<h2>Example: Dynamically cleaning up corrupt PDF documents<a class="headerlink" href="#example-dynamically-cleaning-up-corrupt-pdf-documents" title="Permalink to this headline">¶</a></h2>
<p>This shows a potential use of PyMuPDF with another Python PDF library (<code class="docutils literal"><span class="pre">pdfrw</span></code>).</p>
<p>If a PDF is broken or needs to be decrypted, one could dynamically invoke PyMuPDF to recover from problems like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pdfrw</span> <span class="kn">import</span> <span class="n">PdfReader</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="c">#---------------------------------------</span>
<span class="c"># &#39;tolerant&#39; PDF reader</span>
<span class="c">#---------------------------------------</span>
<span class="k">def</span> <span class="nf">reader</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="n">ifile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
    <span class="n">idata</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>                <span class="c"># put in memory</span>
    <span class="n">ifile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">ibuffer</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">idata</span><span class="p">)</span>           <span class="c"># convert to stream</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PdfReader</span><span class="p">(</span><span class="n">ibuffer</span><span class="p">)</span>       <span class="c"># let us try</span>
    <span class="k">except</span><span class="p">:</span>                             <span class="c"># problem! see if PyMuPDF can heal it</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Document</span><span class="p">(</span><span class="s">&quot;application/pdf&quot;</span><span class="p">,</span>
                            <span class="n">idata</span><span class="p">,</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">idata</span><span class="p">))</span> <span class="c"># scan pdf data in memory</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&quot;test.pdf&quot;</span><span class="p">,</span>            <span class="c"># may want to use a temp file</span>
                 <span class="n">garbage</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                 <span class="n">deflate</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>             <span class="c"># save a cleaned version</span>
        <span class="n">ifile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;test.pdf&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>  <span class="c"># open it</span>
        <span class="n">idata</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>            <span class="c"># put in memory</span>
        <span class="n">ifile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">ibuffer</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">idata</span><span class="p">)</span>       <span class="c"># convert to stream</span>
        <span class="k">return</span> <span class="n">PdfReader</span><span class="p">(</span><span class="n">ibuffer</span><span class="p">)</span>       <span class="c"># now let pdfrw retry</span>
<span class="c">#---------------------------------------</span>

<span class="n">pdf</span> <span class="o">=</span> <span class="n">reader</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span> <span class="n">pdf</span><span class="o">.</span><span class="n">Info</span>
<span class="c"># do further processing</span>
</pre></div>
</div>
<p>With the command line utility <code class="docutils literal"><span class="pre">pdftk</span></code> a similar result can be achieved, see <a class="reference external" href="http://www.overthere.co.uk/2013/07/22/improving-pypdf2-with-pdftk/">here</a>. It even supports buffers for input <strong>and</strong> output. However you must invoke it as a separate process via <code class="docutils literal"><span class="pre">subprocess.Popen</span></code>, using stdin and stdout as communication vehicles.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="class_index.html" title="Classes and Methods"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyMuPDF 1.8.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Ruikai Liu, Jorj McKie.
      Last updated on 15. Jan 2016.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>